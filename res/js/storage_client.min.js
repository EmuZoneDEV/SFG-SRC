define("StorageClient",["PlayaLog"],function(d){function f(a,e){g=a;this.flashId=e;this.iframeLoaded=!1;if(document.getElementById("playastorage"))c=document.getElementById("playastorage");else{var b=document.createElement("iframe");b.style.width="0px";b.style.height="0px";b.style.display="none";b.id="playastorage";c=document.getElementsByTagName("body")[0].appendChild(b)}c.onload=function(){d.message("playastorage iframe loaded");h=!0};c.src="res/js/storage.php";return this}var h=
!1,c=null,k=null,l=0,g="";f.prototype.displayMessage=function(a){d.message("received response: ",a.data);if(a=a.data){var e=document.getElementById(this.flashId);e||(e=this);switch(a[0]){case "get":for(var b in a[1])if(a[1].hasOwnProperty(b))if("function"==typeof e.PlayaStorageDataCallback){d.message("calling AS PlayaStorageDataCallback("+b+", "+a[1][b]+")");try{e.PlayaStorageDataCallback(b,a[1][b])}catch(m){d.message(m.message)}}else d.message("set",b,a[1][b]);break;case "get_all":for(var c in a[1])for(b in a[1][c])if(a[1][c].hasOwnProperty(b))if("function"==
typeof e.PlayaStorageDataCallback){d.message("calling AS PlayaStorageDataCallback("+b+", "+a[1][c][b]+")");try{e.PlayaStorageDataCallback(b,a[1][c][b])}catch(m){d.message(m.message)}}else d.message("set",b,a[1][c][b]);this.NotifyGame(!0)}}};f.prototype.NotifyGame=function(a){var c=document.getElementById(this.flashId);"function"==typeof c.PlayaStorageInitCallback?(d.message("calling AS PlayaStorageInitCallback("+a+")"),c.PlayaStorageInitCallback(a)):d.message("PlayaStorageInitCallback() not defined")};
f.prototype.Init=function(){d.message("PlayaStorageInit called");d.message(g);if("undefined"!==typeof localStorage){try{localStorage.setItem("test","test"),localStorage.removeItem("test")}catch(a){this.NotifyGame(!1);return}k=window.setInterval(function(){l+=1;d.message("checking iframe state");1==h?(h=!1,window.clearInterval(k),c.contentWindow.postMessage(["get_all"],g)):10<l&&(window.clearInterval(k),l=0,this.NotifyGame(!1))},300)}else this.NotifyGame(!1)};f.prototype.Get=function(a){d.message("PlayaStorageGet("+
a+")");c.contentWindow.postMessage(["get",a],g)};f.prototype.Set=function(a,e){d.message("PlayaStorageSet("+a+", "+e+")");c.contentWindow.postMessage(["set",a,e],g)};f.prototype.Unset=function(a){d.message("PlayaStorageUnset("+a+")");c.contentWindow.postMessage(["unset",a],g)};f.prototype.Clear=function(){d.message("PlayaStorageClear()");c.contentWindow.postMessage(["clear"],t_argetUrl)};return f});
